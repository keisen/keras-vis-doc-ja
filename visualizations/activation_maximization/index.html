<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Activation Maximization - Keras-vis Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extras.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Activation Maximization";
    var mkdocs_page_input_path = "visualizations/activation_maximization.md";
    var mkdocs_page_url = "/keras-vis-docs-ja/visualizations/activation_maximization/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Keras-vis Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">可視化について</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Activation Maximization</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#activation-maximization">Activation Maximizationとは</a></li>
    

    <li class="toctree-l3"><a href="#_1">使い方</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_2">シナリオ</a></li>
        
            <li><a class="toctree-l4" href="#_6">高度な使い方</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#tips">Tipsとトリック</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../saliency/">Saliency Maps</a>
                </li>
                <li class="">
                    
    <a class="" href="../class_activation_maps/">Class Activation Maps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">APIドキュメント</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../vis.visualization/">可視化</a>
                </li>
                <li class="">
                    
    <span class="caption-text">最適化</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.losses/">損失関数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.regularizers/">正則化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.optimizer/">オプティマイザ</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.callbacks/">コールバック</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">修飾子</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.input_modifiers/">入力修飾子</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.grad_modifiers/">勾配修飾子</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backprop_modifiers/">誤差逆伝播修飾子</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">その他</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.utils.utils/">ユーティリティ</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backend/">バックエンド</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Keras-vis Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>可視化について &raquo;</li>
        
      
    
    <li>Activation Maximization</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/keisen/keras-vis-docs-ja/blob/master/sources/visualizations/activation_maximization.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="activation-maximization">Activation Maximizationとは</h2>
<p>CNNでは、それぞれの畳み込み層には、入力画像によく似たテンプレートパターンを入力すると、その出力を最大化するいくつかの学習済み<em>テンプレートマッチング</em>フィルタがあります。
最初の畳み込み層は簡単に解釈で、単に重みを画像として可視化するだけです。
畳み込み層がしていることを見るためには、入力ピクセルにフィルタを適用するのが簡単な方法です。
後続の畳み込みフィルタが前の畳み込みフィルタの出力を操作する（いくつかのテンプレートの存在有無を示す）ため、それらの解釈が難しくなります。</p>
<p>Activation Maximizationの背景にあるアイデアは、シンプルにフィルタ出力の活性化を最大にする入力画像を生成することです。
すなわち下記を計算すること。</p>
<p>
<script type="math/tex; mode=display">\frac{\partial ActivationMaximizationLoss}{\partial input}</script>
</p>
<p>そして、その推定値を使って入力を更新することです。<a href="../../vis.losses/#activationmaximization">ActivationMaximization</a>損失関数は
フィルタの活性化を大きくするために出力を小さくします（勾配降下の反復中に損失を最小化します）。
これにより、一種の入力パターンに対して活性化する特定のフィルタを理解することができます。
例えば、入力画像内の眼の存在を活性化するEyeフィルタがあるかもしれません。</p>
<h2 id="_1">使い方</h2>
<p>There are two APIs exposed to perform activation maximization.</p>
<p>ActivationMaximizationを実行するための２つのAPIがあります。</p>
<ol>
<li><a href="../../vis.visualization/#visualize_activation">visualize_activation</a>: This is the general purpose API for visualizing
activations.</li>
<li>
<p><a href="../../vis.visualization/#visualize_activation_with_losses">visualize_activation_with_losses</a>: This is intended for research use-cases where some custom weighted losses can be minimized.</p>
</li>
<li>
<p><a href="../../vis.visualization/#visualize_activation">visualize_activation</a>:これは活性化を可視化するための汎用APIです。</p>
</li>
<li><a href="../../vis.visualization/#visualize_activation_with_losses">visualize_activation_with_losses</a>:これはいくつかのカスタムな重み付き損失の最小化を扱うような研究利用向けです。</li>
</ol>
<p><a href="https://github.com/raghakot/keras-vis/tree/master/examples">examples/</a>にあるコードを参照してください。</p>
<h3 id="_2">シナリオ</h3>
<p>The API is very general purpose and can be used in a wide variety of scenarios. We will list the most common use-cases
below:</p>
<p>APIはとても汎用的な目的で、幅広く様々なシナリオで利用可能です。もっとも一般的なユースケースを下記にリストアップします：</p>
<h4 id="_3">分類出力をおこなう全結合層の可視化</h4>
<p>How can we assess whether a network is over/under fitting or generalizing well? Given an input image, a CNN can 
classify whether it is a cat, bird etc. How can we be sure that it is capturing the correct notion of what it means to be a bird? </p>
<p>ネットワークが過学習（または未学習）しているか、一般化が適切かをどのように評価できますか？
入力画像を与えると、CNNはそれが猫なのか鳥なのかなど分類できます。
それが鳥であることが何を意味するか、その正しい概念をとらえているかどうか確認できますか？</p>
<p>One way to answer these questions is to pose the reverse question:</p>
<blockquote>
<p>Generate an input image that maximizes the final <code>Dense</code> layer output corresponding to bird class. </p>
</blockquote>
<p>それらの問いに対する解の１つは、逆の問いかけをすることです：</p>
<blockquote>
<p>鳥クラスに対応する最終の全結合層を最大化する入力画像を生成する。</p>
</blockquote>
<p>This can be done by pointing <code>layer_idx</code> to final <code>Dense</code> layer, and setting <code>filter_indices</code> to the desired output category. </p>
<p>これは最終の全結合層を<code>layer_idx</code>を指し、<code>filter_indices</code>に望む出力分類を設定することで実現できます。</p>
<ul>
<li>For multi-class classification, <code>filter_indices</code> can point to a single class. 
You could point also point it to multiple categories to see what a cat-fish might look like, as an example.</li>
<li>
<p>For multi-label classifier, simply set the appropriate <code>filter_indices</code>.</p>
</li>
<li>
<p>複数クラス分類問題では、<code>filter_indices</code>は１つのクラスを指すことができます。あなたは"猫 魚"がどのように見えるかを確認するために複数の分類を指すこともできます。</p>
</li>
<li>複数ラベル分類では、適切な<code>filter_index</code>を指定するだけです。</li>
</ul>
<h4 id="_4">回帰出力をおこなう全結合層の可視化</h4>
<p>Unlike class activation visualizations, for regression outputs, we could visualize input that </p>
<ul>
<li>increases</li>
<li>decreases</li>
</ul>
<p>クラス活性化の可視化とは異なり、回帰出力では増加する入力、または減少する入力の可視化ができます。</p>
<p>the regressed <code>filter_indices</code> output. For example, if you trained an apple counter model, increasing the regression
output should correspond to more apples showing up in the input image. Similarly one could decrease the current output.
This can be achieved by using <code>grad_modifier</code> option. As the name suggests, it is used to modify the gradient of losses
with respect to inputs. By default, <code>ActivationMaximization</code> loss is used to increase the output. By setting 
<code>grad_modifier='negate'</code> you can negate the gradients, thus causing output values to decrease. 
<a href="../../vis.grad_modifiers/">gradient_modifiers</a> are very powerful and show up in other visualization APIs as well. </p>
<p>回帰された<code>filter_indices</code>出力。例えばリンゴを数えるモデルを学習して、その回帰出力を増加させることは入力画像内のリンゴを増やすことと一致するはずです。同様に現在の出力を減らすこともできます。これは<code>grad_modifier</code>オプションを使うことで達成できます。名前から連想するように、入力に関する損失の勾配を変更するために使われます。デフォルトでは、<code>ActivationMaximization</code>損失は出力を増加させるために使われます。
<code>grad_modifier='negate'</code>を設定することで勾配の符号反転ができ、これにより出力値を減少させます。
<a href="../../vis.grad_modifiers/">gradient_modifiers</a>はとてもパワフルで、他の可視化APIでもよく使われます。</p>
<h4 id="_5">畳み込みフィルタの可視化</h4>
<p>By pointing <code>layer_idx</code> to <code>Conv</code> layer, you can visualize what pattern activates a filter. This might help you discover
what a filter might be computing. Here, <code>filter_indices</code> refers to the index of the <code>Conv</code> filter within the layer.</p>
<p><code>layer_idx</code>が<code>畳み込み</code>層を指すことで、フィルタを活性化するパターンを可視化できます。これはフィルタがどう計算されているかを理解するのに役立ちます。ここでは、<code>filter_indices</code>はレイヤ内の<code>畳み込み</code>フィルタのインデックスを参照します。</p>
<h3 id="_6">高度な使い方</h3>
<p><a href="../../vis.backprop_modifiers/">backprop_modifiers</a> allow you to modify the backpropagation behavior. For examples, 
you could tweak backprop to only propagate positive gradients by using <code>backprop_modifier='relu'</code>. This parameter also 
accepts a function and can be used to implement your crazy research idea :)</p>
<p><a href="../../vis.backprop_modifiers/">backprop_modifiers</a>を使えば誤差逆伝播の振る舞いを編集することができます。たとえば、
<code>backprop_modifier='relu'</code>を使うことで陽の勾配だけを伝播させるよう微調整できます。このパラメータも関数を受け付け、あなたのクレイジーな研究アイデアを実装するために使うことができます。 :-)</p>
<h2 id="tips">Tipsとトリック</h2>
<ul>
<li>
<p>If you get garbage visualization, try setting <code>verbose=True</code> to see various losses during gradient descent iterations.
By default, <code>visualize_activation</code> uses <code>TotalVariation</code> and <code>LpNorm</code> regularization to enforce natural image prior. It
is very likely that you would see <code>ActivationMaximization Loss</code> bounce back and forth as they are dominated by regularization 
loss weights. Try setting all weights to zero and gradually try increasing values of total variation weight.</p>
</li>
<li>
<p>どうしようもない可視化を得てしまったら、勾配降下反復中の様々なロスを確認するために<code>verbose=True</code>を設定してみて下さい。デフォルトでは、<code>visualize_activation</code>はより自然な画像を得るために<code>TotalVariation</code>と<code>LpNorm</code>の正則化を使います。<code>ActivationMaximization Loss</code>が正則化損失の重み係数に支配され、値が前後に跳ねる様子を見ることができるでしょう。全ての重み係数をゼロに設定して、徐々にTV損失の重み係数を増やしてみてください。</p>
</li>
<li>
<p>To get sharper looking images, use <a href="../../vis.input_modifiers/#jitter">Jitter</a> input modifier.</p>
</li>
<li>
<p>よりシャープな画像を得るために、<a href="../../vis.input_modifiers/#jitter">Jitter</a>入力修飾子を使って下さい。</p>
</li>
<li>
<p>Regression models usually do not provide enough gradient information to generate meaningful input images. Try seeding
the input using <code>seed_input</code> and see if the modifications to the input make sense.</p>
</li>
<li>
<p>回帰モデルは通常、意味ある入力画像を生成するために十分な勾配情報を提供しません。もし意味をなさい場合は、<code>seed_input</code>を使って初期値を与えてみてください。</p>
</li>
<li>
<p>Consider submitting a PR to add more tips and tricks that you found useful.</p>
</li>
</ul>
<p>あなたが発見した有用なTipsやトリックを追加するために、PullRequestを投げることを検討してください。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../saliency/" class="btn btn-neutral float-right" title="Saliency Maps">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../.." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/keisen/keras-vis-docs-ja/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../.." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../saliency/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
