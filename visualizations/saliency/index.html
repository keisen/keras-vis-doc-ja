<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Saliency Maps - Keras-vis Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extras.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Saliency Maps";
    var mkdocs_page_input_path = "visualizations/saliency.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Keras-vis Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Visualizations</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../activation_maximization/">Activation Maximization</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Saliency Maps</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#what-is-saliency">What is Saliency?</a></li>
    

    <li class="toctree-l3"><a href="#usage">Usage</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#scenarios">Scenarios</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../class_activation_maps/">Class Activation Maps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../vis.visualization/">Visualization</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Optimization</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.losses/">losses</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.regularizers/">regularizers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.optimizer/">optimizer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.callbacks/">callbacks</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Modifiers</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.input_modifiers/">input_modifiers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.grad_modifiers/">grad_modifiers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backprop_modifiers/">backprop_modifiers</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Utils</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.utils.utils/">utils</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Backend Specific</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backend/">backend</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Keras-vis Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Visualizations &raquo;</li>
        
      
    
    <li>Saliency Maps</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="http://github.com/raghakot/keras-vis/blob/master/docs/templates/visualizations/saliency.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="what-is-saliency">What is Saliency?</h2>
<p>Suppose that all the training images of <em>bird</em> class contains a tree with leaves. How do we know whether the CNN is 
using bird-related pixels, as opposed to some other features such as the tree or leaves in the image? This actually 
happens more often than you think and you should be especially suspicious if you have a small training set. </p>
<p>Saliency maps was first introduced in the paper: 
<a href="https://arxiv.org/pdf/1312.6034v2.pdf">Deep Inside Convolutional Networks: Visualising Image Classification Models and Saliency Maps</a></p>
<p>The idea is pretty simple. We compute the gradient of output category with respect to input image. This should tell us
how output category value changes with respect to a small change in input image pixels. All the positive values
in the gradients tell us that a small change to that pixel will increase the output value. 
Hence, visualizing these gradients, which are the same shape as the image should provide some intuition of attention.</p>
<p>The idea behind saliency is pretty simple in hindsight. We compute the gradient of output category with respect to 
input image. </p>
<p>
<script type="math/tex; mode=display">\frac{\partial output}{\partial input}</script>
</p>
<p>This should tell us how the output value changes with respect to a small change in inputs. We can use these gradients 
to highlight input regions that cause the most change in the output. Intuitively this should highlight salient image 
regions that most contribute towards the output.</p>
<h2 id="usage">Usage</h2>
<p>There are two APIs exposed to visualize saliency.</p>
<ol>
<li><a href="../vis.visualization#visualize_saliency">visualize_saliency</a>: This is the general purpose API for visualizing
saliency.</li>
<li><a href="../vis.visualization#visualize_saliency_with_losses">visualize_saliency_with_losses</a>: This is intended for 
research use-cases where some custom weighted loss can be used.</li>
</ol>
<p>See <a href="https://github.com/raghakot/keras-vis/tree/master/examples">examples/</a> for code examples.</p>
<h3 id="scenarios">Scenarios</h3>
<p>The API is very general purpose and can be used in a wide variety of scenarios. We will list the most common use-cases
below:</p>
<h4 id="categorical-dense-layer-visualization">Categorical Dense layer visualization</h4>
<p>By setting <code>layer_idx</code> to final <code>Dense</code> layer, and <code>filter_indices</code> to the desired output category, we can visualize 
parts of the <code>seed_input</code> that contribute most towards activating the corresponding output nodes,</p>
<ul>
<li>For multi-class classification, <code>filter_indices</code> can point to a single class.</li>
<li>For multi-label classifier, simply set the appropriate <code>filter_indices</code>.</li>
</ul>
<h4 id="regression-dense-layer-visualization">Regression Dense layer visualization</h4>
<p>For regression outputs, we could visualize attention over input that </p>
<ul>
<li>increases</li>
<li>decreases</li>
<li>maintains</li>
</ul>
<p>the regressed <code>filter_indices</code> output. For example, consider a self driving model with continuous regression steering 
output. One could visualize parts of the <code>seed_input</code> that contributes towards increase, decrease or maintenance of 
predicted output.</p>
<p>By default, saliency tells us how to increase the output activations. For the self driving car case, this only tells
us parts of the input image that contribute towards steering angle increase. Other use cases can be visualized by 
using <code>grad_modifier</code> option. As the name suggests, it is used to modify the gradient of losses with respect to inputs. </p>
<ul>
<li>
<p>To visualize decrease in output, use <code>grad_modifier='negate'</code>. By default, <code>ActivationMaximization</code> loss yields 
positive gradients for inputs regions that increase the output. By setting <code>grad_modifier='negate'</code> you can treat negative
gradients (which indicate the decrease) as positive and therefore visualize decrease use case.</p>
</li>
<li>
<p>To visualize what contributed to the predicted output, we want to consider gradients that have very low positive
or negative values. This can be achieved by performing <code>grads = abs(1 / grads)</code> to magnifies small gradients. Equivalently, 
you can use <code>grad_modifier='small_values'</code>, which does the same thing. <a href="../vis.grad_modifiers">gradient_modifiers</a> 
are very powerful and show up in other visualization APIs as well.</p>
</li>
</ul>
<p>You can see a practical application for this in the 
<a href="https://github.com/raghakot/keras-vis/tree/master/applications/self_driving">self diving car</a> example.</p>
<h4 id="guided-rectified-saliency">Guided / rectified saliency</h4>
<p>Zieler et al. has the idea of clipping negative gradients in the backprop step. i.e., only propagate positive gradient
information that communicates the increase in output. We call this rectified or deconv saliency. Details can be found 
in the paper: <a href="https://arxiv.org/pdf/1311.2901.pdf">Visualizing and Understanding Convolutional Networks</a>.</p>
<p>In guided saliency, the backprop step is modified to only propagate positive gradients for positive activations.
For details see the paper: <a href="https://arxiv.org/pdf/1412.6806.pdf">String For Simplicity: The All Convolutional Net</a>.</p>
<p>For both these cases, we can use <code>backprop_modifier='relu'</code> and <code>backprop_modifier='guided'</code> respectively. You 
can also implement your own <a href="../vis.backprop_modifiers">backprop_modifier</a> to try your crazy research idea :)</p>
<h4 id="conv-filter-saliency">Conv filter saliency</h4>
<p>By pointing <code>layer_idx</code> to <code>Conv</code> layer, you can visualize parts of the image that influence the filter. This might 
help you discover what a filter cares about. Here, <code>filter_indices</code> refers to the index of the <code>Conv</code> filter within 
the layer.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../class_activation_maps/" class="btn btn-neutral float-right" title="Class Activation Maps">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../activation_maximization/" class="btn btn-neutral" title="Activation Maximization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="http://github.com/raghakot/keras-vis/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../activation_maximization/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../class_activation_maps/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
