<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Saliency Maps - Keras-vis Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extras.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Saliency Maps";
    var mkdocs_page_input_path = "visualizations/saliency.md";
    var mkdocs_page_url = "/keras-vis-docs-ja/visualizations/saliency/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Keras-vis Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">可視化について</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../activation_maximization/">Activation Maximization</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Saliency Maps</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#saliency">Saliencyとは</a></li>
    

    <li class="toctree-l3"><a href="#_1">使い方</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_2">シナリオ</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../class_activation_maps/">Class Activation Maps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">APIドキュメント</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../vis.visualization/">可視化</a>
                </li>
                <li class="">
                    
    <span class="caption-text">最適化</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.losses/">損失関数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.regularizers/">正則化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.optimizer/">オプティマイザ</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.callbacks/">コールバック</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">修飾子</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.input_modifiers/">入力修飾子</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.grad_modifiers/">勾配修飾子</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backprop_modifiers/">誤差逆伝播修飾子</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">その他</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.utils.utils/">ユーティリティ</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../vis.backend/">バックエンド</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Keras-vis Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>可視化について &raquo;</li>
        
      
    
    <li>Saliency Maps</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/keisen/keras-vis-docs-ja/blob/master/sources/visualizations/saliency.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="saliency">Saliencyとは</h2>
<p><em>鳥クラス</em>の学習用画像の全てに樹が含まれていたと仮定します。
CNNが画像内の鳥に関連するピクセルを使っているのか、それとも樹や葉のような鳥以外の特徴を使っているかどうかを、どうやって知ることができますか？
これは実際、あなたが考えるよりも頻繁に起こり、小さな学習セットの場合は特に疑う必要があります。</p>
<p>Saliencyマップはこの論文で最初に扱われました：<a href="https://arxiv.org/pdf/1312.6034v2.pdf">Deep Inside Convolutional Networks: Visualising Image Classification Models and Saliency Maps</a>。</p>
<p>Saliencyの背景にあるアイデアは今となっては かなりシンプルです。
入力画像に関する出力カテゴリの勾配を計算します。</p>
<p>
<script type="math/tex; mode=display">\frac{\partial output}{\partial input}</script>
</p>
<p>これは入力の小さな変化に関して出力値がどのように変化するかを教えてくれます。
出力の最も大きな変化の要因となる入力領域を強調するために、これらの勾配を使うことができます。
これは最も出力への貢献が顕著な(salient)入力領域を直感的に強調するはずです。</p>
<h2 id="_1">使い方</h2>
<p>Saliencyを可視化するための２つのAPIがあります。</p>
<ol>
<li><a href="../../vis.visualization/#visualize_saliency">visualize_saliency</a>: Saliencyを可視化するための汎用APIです。</li>
<li><a href="../../vis.visualization/#visualize_saliency_with_losses">visualize_saliency_with_losses</a>: いくつかのカスタムな重み付き付き損失を扱うような研究利用向けです。</li>
</ol>
<p><a href="https://github.com/raghakot/keras-vis/tree/master/examples">examples/</a>にあるコードを参照してください。</p>
<h3 id="_2">シナリオ</h3>
<p>APIはとても一般的な目的で、幅広く様々なシナリオで利用可能です。
最も一般的なユースケースを下記にリストアップします：</p>
<h4 id="_3">分類出力をおこなう全結合層の可視化</h4>
<p><code>layer_idx</code>に最後の<code>全結合</code>層を設定し、<code>filter_indices</code>で出力したいカテゴリを指定することで、
出力ノードに対する活性化に最も貢献する<code>seed_input</code>の一部を可視化することができます。</p>
<ul>
<li>複数クラス分類では、filter_indicesは１つのクラスを指すことができます。 </li>
<li>複数ラベル分類では、適切なfilter_indicesを指定するだけです。</li>
</ul>
<h4 id="_4">回帰出力をおこなう全結合層の可視化</h4>
<p>回帰出力では、<code>filter_indices</code>の出力を</p>
<ul>
<li>増加させる入力</li>
<li>減少させる入力</li>
<li>維持する入力</li>
</ul>
<p>に対する注目を可視化できます。
例えば、継続的に操舵出力を回帰する自動運転モデルを考えます。
このモデルは回帰出力の増加、減少または維持に貢献する<code>seed_input</code>の一部を可視化できます。</p>
<p>デフォルトでは、Saliencyは出力活性化をどうやって増加させるかを教えてくれます。
自動運転のケースで言えば、操舵角度の増加に貢献する入力画像の一部のみを伝えてくれます。
その他は勾配修飾子オプションを使用して可視化できます。
その名前から連想する通り、入力に関する損失の勾配を編集するために使われます。</p>
<ul>
<li>出力の減少を可視化するには、<code>grad_modifier='negate'</code>を使います。
デフォルトでは、<code>ActivationMaximization</code>損失は出力を増加させる入力領域に正の勾配を生じさせます。
<code>grad_modifier='negate'</code>の設定により、（減少を示す）負の勾配を正として扱えるので、減少するケースを可視化できます。</li>
<li>出力に何が貢献したかを可視化するために、正または負のとても小さな値の勾配について考察の必要があります。
これは小さな勾配を増幅するための<code>grads = abs(1 / grads)</code>を実行すれば実現できます。
同等のことは<code>grad_modifier='small_values'</code>で実現できます。
<a href="../../vis.grad_modifiers/">gradient_modifiers</a> はとても強力で、他の可視化APIでもよく使われます。</li>
</ul>
<p><a href="https://github.com/raghakot/keras-vis/tree/master/applications/self_driving">self diving car</a>の例で、実際のアプリケーションを見ることができます。</p>
<h4 id="saliency_1">ガイド付き（または矯正付き）Saliency</h4>
<p>Zielerらは、誤差逆伝播ステップの負で勾配をクリップすることを考えました。
すなわち、出力の増加を伝える正の勾配情報だけを伝搬します。
これを矯正されたSaliencyまたは逆畳み込みのSaliencyと呼びます。
詳細は論文で見ることができます：<a href="https://arxiv.org/pdf/1311.2901.pdf">Visualizing and Understanding Convolutional Networks</a>。</p>
<p>ガイド付きSaliencyでは、誤差逆伝播ステップは正の活性化を得る正の勾配だけを伝播するよう変更されます。
詳しくは論文を参照してください：<a href="https://arxiv.org/pdf/1412.6806.pdf">String For Simplicity: The All Convolutional Net</a></p>
<p>いずれのケースも、それぞれ<code>backprop_modifier='relu'</code>や<code>backprop_modifier='guided'</code>で実現できます。
クレイジーな研究に挑戦するため、自分だけの<a href="../../vis.backprop_modifiers/">backprop_modifier</a>を実装することもできます。</p>
<h4 id="saliency_2">畳み込みフィルタのSaliency</h4>
<p><code>layer_idx</code>で<code>畳み込み</code>層を指して、フィルタに影響を与える画像の一部を可視化できます。
これはフィルタが影響を受けるものについて、気付きを得る助けになります。
ここでは、<code>filter_indices</code>はレイヤ内の<code>畳み込み</code>フィルタのインデックスを参照しています。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../class_activation_maps/" class="btn btn-neutral float-right" title="Class Activation Maps">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../activation_maximization/" class="btn btn-neutral" title="Activation Maximization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/keisen/keras-vis-docs-ja/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../activation_maximization/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../class_activation_maps/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
